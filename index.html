<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Axiom Cortex™ Documentation</title>
  <meta name="theme-color" content="#0b1220"/>
  <meta name="description" content="Technical documentation microsite for Axiom Cortex™."/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.5/dist/purify.min.js"></script>
  <style>
    :root {
      --bg: #161b22;
      --panel: #0d1117;
      --accent: #7bb3ff;
      --text: #e6e9f0;
      --muted: #a6adbb;
      --border: rgba(255,255,255,.12);
      --radius: 16px;
      --header-h: 70px;
    }
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); }
    ::-webkit-scrollbar { width: 10px; background: var(--panel);}
    ::-webkit-scrollbar-thumb { background: #222b3c; border-radius: 6px;}
    main :where(h1,h2,h3,h4,h5,h6) { scroll-margin-top: calc(var(--header-h) + 18px); }
    .toc-active { background: rgba(123,179,255,0.15); color: var(--accent) !important; }
    .toc-link { cursor: pointer;}
    .prose a { color: var(--accent); text-underline-offset: 2px; }
    .prose pre, .prose code { background-color: #202737!important; border-radius: 8px;}
    .prose blockquote { border-left: 4px solid var(--accent); background: #232b3b; padding: 1em; margin: 1em 0;}
    .prose img { max-width: 100%; border-radius: 8px; }
    .prose table { border-collapse: collapse; border: 1px solid #333; }
    .prose th, .prose td { border: 1px solid #333; padding: 6px 12px;}
    .prose ul, .prose ol { margin-left: 1.4em; }
    .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 { 
      color: var(--text); 
      margin-top: 2rem; 
      margin-bottom: 1rem; 
      line-height: 1.25; 
    }
    .prose h1 { font-size: 2.25rem; font-weight: 800; }
    .prose h2 { font-size: 1.875rem; font-weight: 700; }
    .prose h3 { font-size: 1.5rem; font-weight: 600; }
    .prose h4 { font-size: 1.25rem; font-weight: 600; }
    .prose h5 { font-size: 1.125rem; font-weight: 600; }
    .prose h6 { font-size: 1rem; font-weight: 600; }
    .prose p { margin-bottom: 1rem; line-height: 1.75; }
    .prose ul li, .prose ol li { margin-bottom: 0.5rem; }
    .prose ul { list-style-type: disc; }
    .prose ol { list-style-type: decimal; }
    .prose ul ul { list-style-type: circle; margin-top: 0.5rem; }
    .prose ul ul ul { list-style-type: square; }
    .prose strong { font-weight: 700; color: var(--text); }
    .prose em { font-style: italic; }
    .prose hr { border-color: var(--border); margin: 2rem 0; }
    .prose code { 
      background-color: #202737; 
      color: #e2e8f0; 
      padding: 0.125rem 0.25rem; 
      border-radius: 0.25rem; 
      font-size: 0.875em; 
    }
    .prose pre code { 
      background-color: transparent; 
      padding: 0; 
    }
    @media (max-width: 1023px) {
      aside#tocWrap { display: none !important; }
    }
    @media (max-width: 640px) {
      nav#mainNav { flex-direction: column; gap: 0.5rem;}
      .prose { padding: 0.8em !important; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="bg-[--panel] border-b border-white/10 sticky top-0 z-40" role="banner">
    <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between px-4 py-4">
      <span class="text-xl font-extrabold tracking-tight text-white" aria-label="Site Title">Axiom Cortex™</span>
      <nav id="mainNav" class="flex flex-wrap items-center gap-6" aria-label="Primary"></nav>
      <a href="https://calendar.google.com/calendar/u/0/appointments/schedules/AcZssZ1JD2e4SmSzEC82NiTvzvUJNaghMafqlUdoTB9YlWfUSsJa2fC4uqoXGoOb9XNhRIsNa-IOIXSq" target="_blank" rel="noopener"
         class="rounded-full bg-[--accent] px-4 py-2 text-xs font-semibold text-black hover:brightness-110 shadow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[--accent]"
         aria-label="Schedule Demo">
        Schedule Demo
      </a>
    </div>
  </header>
  <main class="flex-1 w-full max-w-7xl mx-auto flex flex-row gap-6 px-2 md:px-6" id="mainContainer">
    <aside id="tocWrap" class="hidden lg:block w-72 shrink-0 pt-8" aria-label="Table of Contents">
      <div class="sticky top-32 bg-[#101624] rounded-xl border border-white/10 shadow-lg p-5">
        <div class="font-bold text-white mb-2 text-lg tracking-wide">Contents</div>
        <nav id="toc" class="text-[15px] flex flex-col gap-1"></nav>
      </div>
    </aside>
    <section class="flex-1 min-w-0">
      <article id="content" class="prose prose-invert max-w-none lg:rounded-2xl bg-[--panel] border border-white/10 shadow-xl mt-8 mb-12 p-6" tabindex="0" aria-live="polite">Loading…</article>
    </section>
  </main>
  <footer class="bg-[--panel] border-t border-white/10 text-center py-8 mt-auto">
    <div class="text-[15px] text-[--muted]">© 2025 TeamStation AI. Axiom Cortex™ Technical Methodology. | 
      <a href="https://calendar.google.com/calendar/u/0/appointments/schedules/AcZssZ1JD2e4SmSzEC82NiTvzvUJNaghMafqlUdoTB9YlWfUSsJa2fC4uqoXGoOb9XNhRIsNa-IOIXSq" class="text-[--accent] underline" target="_blank">Schedule a Demo</a>
    </div>
  </footer>
  <script>
    const RAW_BASE = "https://raw.githubusercontent.com/teamstation-ai/Axiom-Cortex-Methodology/main/";
    const PAGES_JSON = "_pages.json";
    let pages = [];

    function parseMarkdown(md) {
      // Configure marked with enhanced options
      marked.setOptions({
        breaks: true,        // Support line breaks
        gfm: true,          // GitHub Flavored Markdown
        tables: true,       // Support tables
        sanitize: false,    // Allow HTML (we'll use DOMPurify)
        smartLists: true,   // Better list handling
        smartypants: true,  // Smart quotes and dashes
        xhtml: false,       // HTML5 mode
        headerIds: true,    // Generate header IDs
        mangle: false       // Don't mangle email addresses
      });
      
      // Create a custom renderer for better styling
      const renderer = new marked.Renderer();
      
      // Enhance list rendering
      renderer.list = function(body, ordered, start) {
        const type = ordered ? 'ol' : 'ul';
        const startatt = (ordered && start !== 1) ? ' start="' + start + '"' : '';
        return '<' + type + startatt + ' class="' + (ordered ? 'list-decimal' : 'list-disc') + ' pl-6 space-y-2">\n' + body + '</' + type + '>\n';
      };
      
      renderer.listitem = function(text) {
        return '<li class="leading-relaxed">' + text + '</li>\n';
      };
      
      // Enhance paragraph rendering
      renderer.paragraph = function(text) {
        return '<p class="mb-4 leading-relaxed">' + text + '</p>\n';
      };
      
      // Enhance header rendering with proper spacing
      renderer.heading = function(text, level, raw) {
        const escapedText = text.toLowerCase().replace(/[^\w]+/g, '-');
        const classes = {
          1: 'text-4xl font-bold mb-6 mt-8 text-white',
          2: 'text-3xl font-semibold mb-4 mt-6 text-white',
          3: 'text-2xl font-semibold mb-3 mt-5 text-white',
          4: 'text-xl font-semibold mb-3 mt-4 text-white',
          5: 'text-lg font-semibold mb-2 mt-4 text-white',
          6: 'text-base font-semibold mb-2 mt-3 text-white'
        };
        
        return '<h' + level + ' id="' + escapedText + '" class="' + (classes[level] || classes[6]) + '">' + text + '</h' + level + '>\n';
      };
      
      // Enhance code block rendering
      renderer.code = function(code, lang) {
        return '<pre class="bg-[#1a1f2e] rounded-lg p-4 my-4 overflow-x-auto border border-gray-700"><code class="text-sm text-gray-200">' + code + '</code></pre>\n';
      };
      
      // Enhance blockquote rendering
      renderer.blockquote = function(quote) {
        return '<blockquote class="border-l-4 border-blue-400 bg-slate-800/50 pl-6 py-2 my-4 italic">' + quote + '</blockquote>\n';
      };
      
      // Set the custom renderer
      marked.setOptions({ renderer: renderer });
      
      // Parse and sanitize
      const html = marked.parse(md);
      return typeof DOMPurify !== 'undefined' ? DOMPurify.sanitize(html) : html;
    }

    async function loadNav() {
      try {
        const resp = await fetch(RAW_BASE + PAGES_JSON);
        pages = await resp.json();
        const nav = document.getElementById('mainNav');
        nav.innerHTML = "";
        pages.forEach((p) => {
          const a = document.createElement("a");
          if (p.external) {
            a.href = p.file;
            a.target = "_blank";
            a.rel = "noopener";
          } else {
            a.href = "#" + encodeURIComponent(p.file);
          }
          a.className = "text-[--accent] font-medium hover:text-white px-2 py-1 rounded transition navlink focus:outline-none focus-visible:ring-2 focus-visible:ring-[--accent]";
          a.textContent = p.title;
          nav.appendChild(a);
        });
      } catch (e) {
        document.getElementById('mainNav').innerHTML = "<span class='text-red-400'>[Navigation failed]</span>";
      }
    }

    async function loadPage(mdfile) {
      const page = pages.find(p => p.file === mdfile);
      if (page && page.external) {
        window.open(page.file, "_blank", "noopener");
        return;
      }
      const content = document.getElementById('content');
      content.innerHTML = "<div class='text-gray-400'>Loading…</div>";
      try {
        const resp = await fetch(RAW_BASE + mdfile + "?v=" + Date.now());
        if (!resp.ok) throw new Error("Could not load: " + mdfile);
        const md = await resp.text();
        
        // Check if marked is available, otherwise use basic HTML rendering
        if (typeof marked !== 'undefined') {
          content.innerHTML = parseMarkdown(md);
        } else {
          // Fallback: Basic HTML conversion for common Markdown elements
          let html = md
            .replace(/^### (.*$)/gim, '<h3 class="text-2xl font-semibold mb-3 mt-5 text-white">$1</h3>')
            .replace(/^## (.*$)/gim, '<h2 class="text-3xl font-semibold mb-4 mt-6 text-white">$1</h2>')
            .replace(/^# (.*$)/gim, '<h1 class="text-4xl font-bold mb-6 mt-8 text-white">$1</h1>')
            .replace(/\*\*(.*?)\*\*/g, '<strong class="font-bold text-white">$1</strong>')
            .replace(/\*(.*?)\*/g, '<em class="italic">$1</em>')
            .replace(/`(.*?)`/g, '<code class="bg-slate-700 text-gray-200 px-1 py-0.5 rounded text-sm">$1</code>')
            .replace(/^[\*\-\+] (.*)$/gim, '<li class="leading-relaxed ml-6">$1</li>')
            .replace(/\n\n/g, '</p><p class="mb-4 leading-relaxed">')
            .replace(/^(?!<[h|l|p])/gm, '<p class="mb-4 leading-relaxed">')
            .replace(/(<\/p><p[^>]*>)$/, '');
          
          content.innerHTML = html;
        }
        
        buildTOC();
        highlightActiveNav(mdfile);
        content.focus();
        window.scrollTo({top:0});
      } catch (e) {
        content.innerHTML = `<div class="text-red-400">Error loading <b>${mdfile}</b><br>Could not load: ${mdfile}</div>`;
        document.getElementById('toc').innerHTML = "";
      }
    }

    function buildTOC() {
      const toc = document.getElementById('toc');
      toc.innerHTML = "";
      const content = document.getElementById('content');
      const hs = [...content.querySelectorAll('h1, h2, h3')];
      if (!hs.length) { document.getElementById('tocWrap').style.display = "none"; return; }
      else { document.getElementById('tocWrap').style.display = ""; }
      hs.forEach(h => {
        if (!h.id) h.id = h.textContent.toLowerCase().replace(/[^\w]+/g, '-');
      });
      hs.forEach(h => {
        const a = document.createElement('a');
        a.href = "#" + h.id;
        a.textContent = h.textContent;
        a.className = "block toc-link py-1 px-2 rounded hover:bg-[#202737] focus:outline-none";
        a.style.marginLeft = h.tagName === "H2" ? "1rem" : h.tagName === "H3" ? "2rem" : "0";
        a.setAttribute('aria-label', h.textContent);
        toc.appendChild(a);
      });
      toc.querySelectorAll('.toc-link').forEach(a => {
        a.addEventListener('click', function(e){
          e.preventDefault();
          const t = document.getElementById(this.getAttribute('href').slice(1));
          if (t) t.scrollIntoView({behavior:'smooth', block:'start'});
        });
      });
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          const id = entry.target.id;
          const tocLinks = toc.querySelectorAll('.toc-link');
          tocLinks.forEach(link => {
            if (link.getAttribute('href') === '#' + id) {
              link.classList.toggle('toc-active', entry.isIntersecting && entry.intersectionRatio > 0.55);
            }
          });
        });
      }, {
        root: null,
        threshold: [0.55],
        rootMargin: "-40% 0px -50% 0px"
      });
      hs.forEach(h => observer.observe(h));
    }

    function highlightActiveNav(mdfile) {
      document.querySelectorAll('.navlink').forEach(a => {
        a.classList.toggle('bg-[#202737]', a.getAttribute('href') === "#" + mdfile);
        a.setAttribute('aria-current', a.getAttribute('href') === "#" + mdfile ? 'page' : 'false');
      });
    }

    function route() {
      let file = decodeURIComponent(location.hash.replace(/^#/, "")) || (pages[0]?.file || "index.md");
      const page = pages.find(p => p.file === file);
      if (page && page.external) {
        window.location.hash = "";
        window.open(page.file, "_blank", "noopener");
        return;
      }
      loadPage(file);
    }

    (async function() {
      await loadNav();
      window.addEventListener('hashchange', route);
      route();
    })();
  </script>
</body>
</html>
