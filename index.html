<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TeamStation AI | Axiom Cortex™ — Technical Methodology</title>
  <meta name="description" content="Technical methodology brief for the Axiom Cortex cognitive AI engine." />
  <meta name="theme-color" content="#0b1220" />

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Dark, blue-only palette -->
  <style type="text/tailwindcss">
    @layer base {
      :root{
        --bg:#161b22;          /* page background (dark) */
        --panel:#0d1117;       /* cards/panels */
        --primary-900:#0b1220; /* deep navy */
        --primary-800:#0f1b2e; /* darker navy */
        --accent:#7bb3ff;      /* blue only */
        --text:#e6e9f0;
        --muted:#a6adbb;
        --border:rgba(255,255,255,.12);
        --radius:16px;
        --maxw:1200px;
        --header-h:72px;
        --toc-w:300px;
      }
    }
    /* neat scrollbars */
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:#0d1117}
    ::-webkit-scrollbar-thumb{background:#3a4a5f;border-radius:4px}
    ::-webkit-scrollbar-thumb:hover{background:#4a5f7a}
    /* fixed header offset for in-page headings */
    :where(h1,h2,h3,h4,h5,h6){scroll-margin-top:calc(var(--header-h) + 12px)}
  </style>
</head>
<body class="bg-[--bg] text-[--text] font-sans">
  <!-- HEADER: brand left, CENTERED nav, CTA right -->
  <header class="fixed top-0 z-50 w-full border-b border-white/10 bg-zinc-900/60 backdrop-blur-md">
    <div class="mx-auto grid max-w-[var(--maxw)] grid-cols-[1fr_auto_1fr] items-center gap-3 px-4 py-4">
      <a href="#/README.md" class="justify-self-start text-base font-semibold tracking-wide text-white hover:text-[--accent]">
        TeamStation AI | Axiom Cortex™
      </a>

      <!-- Centered nav; items inserted by JS only for files that exist -->
      <nav aria-label="Primary" class="justify-self-center">
        <ul id="top-nav" class="flex items-center gap-6"></ul>
      </nav>

      <div class="justify-self-end hidden md:flex items-center gap-2">
        <a id="cta-schedule" target="_blank" rel="noopener"
           class="rounded-full bg-[--accent] px-3 py-2 text-xs font-semibold text-black hover:brightness-110">
          Schedule Demo
        </a>
      </div>
    </div>
  </header>

  <!-- MAIN: TOC + content -->
  <main class="mx-auto grid max-w-[var(--maxw)] grid-cols-1 gap-6 px-4 pt-[calc(var(--header-h)+20px)] pb-24 lg:grid-cols-[var(--toc-w)_1fr]">
    <!-- Sidebar TOC (auto from headings in the loaded MD) -->
    <aside class="hidden lg:block sticky top-[calc(var(--header-h)+16px)] self-start rounded-2xl border border-white/10 bg-[--panel] shadow-2xl">
      <div class="border-b border-white/10 px-4 py-3 text-sm font-semibold">Contents</div>
      <nav id="toc" class="max-h-[65vh] overflow-auto px-2 py-2 text-sm"></nav>
    </aside>

    <!-- Content panel -->
    <article id="content" class="min-w-0 rounded-2xl border border-white/10 bg-[--panel] p-5 shadow-2xl">
      <p class="text-[--muted]">Loading…</p>
    </article>
  </main>

  <!-- FOOTER (uses _footer.md if present; falls back to default) -->
  <footer class="border-t border-white/10 bg-zinc-900/80">
    <div id="footer" class="mx-auto flex max-w-[var(--maxw)] flex-col items-center gap-3 px-4 py-6 text-center text-[--muted]">
      <p>© 2025 TeamStation AI. Axiom Cortex™ Technical Methodology.</p>
      <p><a id="footer-schedule" target="_blank" rel="noopener" class="text-[--accent] hover:brightness-110">Schedule a Technical Demo →</a></p>
    </div>
  </footer>

  <!-- APP: load real MD files, build TOC, super-accurate scrollspy; nav only for files that exist -->
  <script>
    /* ---------- config ---------- */
    const SCHEDULE_URL = 'https://calendar.google.com/calendar/u/0/appointments/schedules/AcZssZ1JD2e4SmSzEC82NiTvzvUJNaghMafqlUdoTB9YlWfUSsJa2fC4uqoXGoOb9XNhRIsNa-IOIXSq';

    // Canonical pages you use today. Add to this list when you create new .md files.
    const PAGES = [
      { title: 'Overview',                file: 'README.md' },
      { title: 'Architecture',            file: 'architecture.md' },
      { title: 'Scientific Foundations',  file: 'scientific-foundations.md' },
      { title: 'Risk & Reliability',      file: 'risk-and-reliability.md' }
    ];

    /* ---------- helpers ---------- */
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const esc = s => s.replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]));

    function routeFile() {
      const h = location.hash.replace(/^#\/?/, '').trim();
      return h || 'README.md';
    }

    async function urlExists(file){
      try {
        // Try HEAD first; if blocked, fall back to GET
        const head = await fetch(file, { method:'HEAD', cache:'no-store' });
        if (head.ok) return true;
      } catch(e){}
      try {
        const get = await fetch(file+'?ts='+Date.now(), { cache:'no-store' });
        return get.ok;
      } catch(e){ return false; }
    }

    /* ---------- MD pipeline (tiny) ---------- */
    function preprocessFences(md){
      const out=[], lines=md.replace(/\r\n?/g,"\n").split("\n");
      let inFence=false, lang="", buf=[];
      for(const line of lines){
        const m=line.match(/^```(\w+)?\s*$/);
        if(m){
          if(!inFence){ inFence=true; lang=(m[1]||""); buf=[]; }
          else{
            out.push(`<pre class="overflow-auto rounded-xl border border-white/10 bg-[#0a162d] p-4"><code class="lang-${lang}">${esc(buf.join("\n"))}</code></pre>`);
            inFence=false; lang=""; buf=[];
          }
          continue;
        }
        if(inFence) buf.push(line); else out.push(line);
      }
      if(inFence) out.push(`<pre class="overflow-auto rounded-xl border border-white/10 bg-[#0a162d] p-4"><code>${esc(buf.join("\n"))}</code></pre>`);
      return out.join("\n");
    }

    function mdToHtml(md){
      // blockquotes
      md = md.replace(/^>\s*(.+)$/gm,'<blockquote class="my-4 rounded-r-xl border-l-4 border-[--accent] bg-white/5 px-4 py-3">$1</blockquote>');
      // headings
      md = md.replace(/^######\s*(.+)$/gm,'<h6 class="mt-6 mb-2 font-semibold">$1</h6>')
             .replace(/^#####\s*(.+)$/gm,'<h5 class="mt-6 mb-2 font-semibold">$1</h5>')
             .replace(/^####\s*(.+)$/gm,'<h4 class="mt-6 mb-2 text-lg font-bold">$1</h4>')
             .replace(/^###\s*(.+)$/gm,'<h3 class="mt-6 mb-2 text-xl font-bold">$1</h3>')
             .replace(/^##\s*(.+)$/gm,'<h2 class="mt-7 mb-3 text-2xl font-bold">$1</h2>')
             .replace(/^#\s*(.+)$/gm,'<h1 class="mt-2 mb-4 text-3xl font-bold">$1</h1>');
      // hr
      md = md.replace(/^\s*([-*_])\1\1+\s*$/gm,'<hr class="my-6 border-white/10">');
      // lists
      md = md.replace(/^(?:\s*)[-*+]\s+(.+)$/gm,'<li>$1</li>');
      md = md.replace(/(<li>[\s\S]*?<\/li>)/gms,'<ul class="my-4 list-disc pl-6 space-y-1">$1</ul>');
      // inline
      md = md.replace(/`([^`]+)`/g,'<code class="rounded bg-white/10 px-1 py-0.5">$1</code>');
      md = md.replace(/\*\*([^*]+)\*\*/g,'<strong>$1</strong>').replace(/\*([^*]+)\*/g,'<em>$1</em>');
      md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a class="text-[--accent] font-semibold hover:brightness-110" href="$2" target="_blank" rel="noopener">$1</a>');
      // paragraphs
      md = md.split(/\n{2,}/).map(b=>/^\s*</.test(b.trim())?b:`<p class="my-3 leading-relaxed text-[--text]/95">${b.replace(/\n/g,'<br>')}</p>`).join('\n');
      return md;
    }

    function highlight(codeEl){
      const cls=codeEl.className||'', lang=(cls.match(/lang-([a-z0-9]+)/i)||[])[1]||'';
      let h=codeEl.innerHTML;
      const re={
        str:/(&quot;[^&]*?&quot;|&#39;[^&]*?&#39;|`[^`]*`)/g,
        num:/\b(\d+(?:\.\d+)?)\b/g,
        com:/(\/\/.*?$|\/\*[\s\S]*?\*\/)/gm,
        kw:/\b(await|break|case|catch|class|const|continue|debugger|default|delete|do|else|export|extends|finally|for|from|function|if|import|in|instanceof|let|new|null|of|return|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/g,
        tag:/(&lt;\/?[a-zA-Z0-9\-]+)(?=[\s&gt;])/g,
        attr:/([a-zA-Z\-:]+)=(&quot;[^&]*&quot;|&#39;[^&]*&#39;)/g
      };
      if(/^(js|ts|javascript|typescript)$/.test(lang)){
        h=h.replace(re.com,'<span class="text-slate-400 italic">$1</span>')
            .replace(re.str,'<span class="text-cyan-200">$1</span>')
            .replace(re.kw,'<span class="text-blue-200 font-semibold">$1</span>')
            .replace(re.num,'<span class="text-blue-100">$1</span>');
      }else if(/^(html|xml|svg|markup)$/.test(lang)){
        h=h.replace(re.attr,'<span class="text-blue-100">$1</span>=<span class="text-cyan-200">$2</span>')
            .replace(re.tag,'<span class="text-blue-200">$1</span>');
      }else if(/^(json)$/.test(lang)){
        h=h.replace(/(&quot;[^&]*?&quot;)(\s*:)/g,'<span class="text-blue-100">$1</span>$2')
            .replace(re.str,'<span class="text-cyan-200">$1</span>')
            .replace(re.num,'<span class="text-blue-100">$1</span>');
      }
      codeEl.innerHTML=h;
    }

    /* ---------- super-accurate scrollspy ---------- */
    // We combine IntersectionObserver (medium viewport band) + a throttled scroll fallback
    // + ResizeObserver to keep positions fresh when content changes (images, fonts, md updates).
    const spy = {
      headings: [],
      map: new Map(),
      ticking: false,
      headerOffset: () => (parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h')) || 72) + 16,

      collect(){
        const hs = $$('#content h1, #content h2, #content h3');
        this.headings = hs;
        this.map.clear();
        hs.forEach(h => {
          if (!h.id) h.id = slug(h.textContent);
          this.map.set(h.id, h);
        });
      },

      // Binary search fallback for active heading
      activeByScroll(){
        const top = window.scrollY + this.headerOffset();
        let lo = 0, hi = this.headings.length - 1, idx = 0;
        while (lo <= hi){
          const mid = (lo + hi) >> 1;
          const el = this.headings[mid];
          const y = el.getBoundingClientRect().top + window.scrollY;
          if (y <= top){ idx = mid; lo = mid + 1; } else { hi = mid - 1; }
        }
        return this.headings[idx];
      },

      setActive(id){
        const tocLinks = $$('#toc a');
        tocLinks.forEach(a => a.classList.toggle('bg-white/10', a.getAttribute('href') === '#'+id));
      },

      observe(){
        if (this.io) this.io.disconnect();
        this.io = new IntersectionObserver(entries => {
          // Use a central viewport band to reduce jitter
          entries.forEach(en => {
            if (en.isIntersecting){
              this.setActive(en.target.id);
            }
          });
        }, { root: null, rootMargin: '-45% 0px -45% 0px', threshold: [0, 1] });
        this.headings.forEach(h => this.io.observe(h));
      },

      onScroll(){
        if (this.ticking) return;
        this.ticking = true;
        requestAnimationFrame(() => {
          // Fallback ensures accuracy when IO misses fast jumps
          const active = this.activeByScroll();
          if (active) this.setActive(active.id);
          this.ticking = false;
        });
      },

      watchResize(){
        if (this.ro) this.ro.disconnect();
        this.ro = new ResizeObserver(() => {
          this.collect(); this.observe();
        });
        this.ro.observe($('#content'));
      }
    };

    function slug(s){ return s.toLowerCase().trim().replace(/[^\w\s-]/g,'').replace(/\s+/g,'-').replace(/-+/g,'-'); }

    function buildTOC(){
      const toc = $('#toc'); if(!toc) return;
      toc.innerHTML='';
      const hs = $$('#content h1, #content h2, #content h3');
      hs.forEach(h=>{
        if(!h.id) h.id = slug(h.textContent);
        const a = document.createElement('a');
        a.href = '#'+h.id;
        a.textContent = h.textContent;
        a.className = (h.tagName==='H1' ? 'block px-2 py-1.5 font-semibold rounded-lg hover:bg-white/10'
                    : h.tagName==='H2' ? 'block px-3 py-1.5 rounded-lg hover:bg-white/10'
                    : 'block px-4 py-1.5 text-[--muted] hover:bg-white/10');
        toc.appendChild(a);
      });
      // smooth scroll on click
      toc.addEventListener('click', e=>{
        const a = e.target.closest('a[href^="#"]'); if(!a) return;
        e.preventDefault();
        const id = a.getAttribute('href').slice(1);
        const el = document.getElementById(id);
        if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
        history.replaceState(null,'','#'+id);
      });

      // wire up scrollspy
      spy.collect();
      spy.observe();
      spy.watchResize();
      window.removeEventListener('scroll', spy._bound);
      spy._bound = spy.onScroll.bind(spy);
      window.addEventListener('scroll', spy._bound, {passive:true});
    }

    async function loadFooter(){
      try{
        const r = await fetch('_footer.md?ts='+Date.now(), {cache:'no-store'});
        if(!r.ok) return;
        const md = await r.text();
        $('#footer').innerHTML = mdToHtml(preprocessFences(md));
      }catch(e){}
    }

    async function render(){
      const file = routeFile();
      // set active in top nav
      $$('#top-nav a').forEach(a=>a.classList.toggle('text-[--accent]', a.dataset.file===file));

      try{
        const res = await fetch(file + '?ts=' + Date.now(), {cache:'no-store'});
        if(!res.ok) throw new Error('404');
        const md = await res.text();
        const html = mdToHtml(preprocessFences(md));
        $('#content').innerHTML = html;
        $$('pre > code', $('#content')).forEach(highlight);
        buildTOC();
        window.scrollTo({top:0, behavior:'instant'});
      }catch(e){
        $('#content').innerHTML = `
          <h1 class="mb-2 text-2xl font-bold">404 — Not found</h1>
          <p class="text-[--muted]">Could not load <code class="rounded bg-white/10 px-1">${esc(file)}</code>.</p>`;
        $('#toc').innerHTML='';
      }
    }

    // Build top nav dynamically: ONLY include files that actually exist
    async function buildTopNav(){
      const nav = $('#top-nav'); nav.innerHTML='';
      for (const p of PAGES){
        if (await urlExists(p.file)){
          const li = document.createElement('li');
          li.innerHTML = `<a href="#/${p.file}" data-file="${p.file}" class="navlink text-sm font-medium hover:text-[--accent]">${p.title}</a>`;
          nav.appendChild(li);
        }
      }
      // If none found, at least show Overview
      if(!nav.children.length){
        const li = document.createElement('li');
        li.innerHTML = `<a href="#/README.md" data-file="README.md" class="navlink text-sm font-medium hover:text-[--accent]">Overview</a>`;
        nav.appendChild(li);
      }
    }

    // Router
    window.addEventListener('hashchange', render);
    window.addEventListener('DOMContentLoaded', async ()=>{
      // set Schedule links
      const s1 = $('#cta-schedule'); if (s1) { s1.href = SCHEDULE_URL; }
      const s2 = $('#footer-schedule'); if (s2) { s2.href = SCHEDULE_URL; }

      await buildTopNav();
      if(!location.hash) location.hash = '/README.md';
      await render();
      await loadFooter();
    });
  </script>
</body>
</html>
